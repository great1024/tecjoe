(()=>{var e=new RegExp(/((&#\d{2,4};)|(&[a-z]{2};)|(&[a-z]{3,7};)|(%[a-fA-F0-9]{2})|(\W))pd_rd_plhdr(=|%3D)t((&#\d{2,4};)|(&[a-z]{2,7};)|(%[a-fA-F0-9]{2})|(\W))/),t="$1",i="$8",a=function(a,s){var r=s,n=a;if("&pd_rd_plhdr=t"===a||""===a.trim())return r;(n=n.replace(/&amp;/g,"&")).startsWith("&")&&(n=n.replace(/^&+/,"")),n.endsWith("&")&&(n=n.replace(/&+$/,""));try{var o=void 0,d=0;do{if(d++,!(o=r.match(e)))break;var l=o[1],c=o[8],h=o[7],m=l.startsWith("&")&&l.endsWith(";")||c.startsWith("&")&&c.endsWith(";"),u=l.startsWith("%")&&c.startsWith("%")&&"%3D"===h;r=m?r.replace(e,t+n.replace(/&/g,"&amp;")+i):u?r.replace(e,t+encodeURIComponent(n)+i):r.replace(e,t+n+i)}while(o&&d<10)}catch(e){return s}return r};let s="adload_renderstart",r="adload_renderend",n="viewability",o="unservedviewability",d=e=>"V"===e,l={1027:"Sponsored Display DRA"},c=(e,t)=>d(e)&&!l.hasOwnProperty(t),h={1:"Enabled",0:"NotEnabled","-1":"Unknown"},m=e=>u(e),u=e=>decodeURIComponent(escape(atob(e))),v=e=>e&&0===Object.keys(e).length&&e.constructor===Object,g=null,w=null,p=null,f=null,y=null,b=new class e{viewabilityStandards(){return f=f||[]}payload(){return p=p||{}}},C={ext:{inViewPercentage:()=>Math.round(100*(g=g||0)),geom:()=>w=w||{}}},M={playingTime:()=>y=y||0},E=()=>C,x=()=>b,I=()=>M,P=e=>{var t,i,a,s;null===(g=(null===(i=null===(t=null==e?void 0:e.geom)||void 0===t?void 0:t.self)||void 0===i?void 0:i.iv)!==void 0?null===(s=null===(a=null==e?void 0:e.geom)||void 0===a?void 0:a.self)||void 0===s?void 0:s.iv:null)&&delete C.ext.inViewPercentage,null===(w=(null==e?void 0:e.geom)!==void 0?null==e?void 0:e.geom:null)&&delete C.ext.geom,null===(p=(null==e?void 0:e.payload)!==void 0?null==e?void 0:e.payload:null)&&delete b.payload,null===(f=(null==e?void 0:e.viewabilityStandards)!==void 0?null==e?void 0:e.viewabilityStandards:null)&&delete b.viewabilityStandards},T=e=>{null===(y=e)&&delete M.playingTime},S="sfImpression",A="LightAdImpression",L=(e,t,i)=>({csaKey:e,csmKey:t,csmMessage:i});L("bodyBegin","bb",S),L("bodyBegin","bb",A);let F=L("bodyEnd","be");L("clickToATF","af"),L("criticalFeature","cf"),L("criticalFeature","cf",S),L("criticalFeature","cf",A);let R=L("loaded","ld"),k=L("loaded","ld",S);L("loaded","ld",A),L("viewablelatency:loaded","ld","viewablelatency");let D="adfetch_punt",N="adfetch_error",_="adfetch_noad",B="adfetch_renderad",U="adfetch_rendererror",O="adload:renderstart",V="adload:renderend",H="adload:viewability",W="adload:unservedviewability",z="cod_client",$=async(e,t)=>{let i=async i=>{let a=m(i.detail.htmlContentEncoded),s=m(t||"");await e(a,s)};await new Promise(e=>document.addEventListener("loadAdWithRelocatedHtmlContent",async t=>{await i(t),e()},{once:!0}))},j=()=>{try{Object&&Object.defineProperty&&"function"==typeof Object.defineProperty?Object.defineProperty(document,"cookie",{get:function(){return""},set:function(){}}):(document.__defineGetter__("cookie",function(){return""}),document.__defineSetter__("cookie",function(){}))}catch(e){}},q=()=>{window.navigator&&window.navigator.geolocation&&(window.navigator.geolocation.watchPosition=(e,t,i)=>0,window.navigator.geolocation.getCurrentPosition=()=>{})},G=(e,t,i)=>{t.isNoInventory=!0,Z(e,t,i),i.sendMessage("startPixelTracking",{measurementMethod:z,isNoInventory:t.isNoInventory})},J=e=>/^https/.test(e),K=e=>e?e.replace(/^http:/,"https:"):e,Q=(e,t)=>{console.error(e,t)},X=async(e,t,i,a,s)=>{let r={callBackReceived:!0,errFallback:e.handleFallbackBehavior.name};if(i&&0!==Object.keys(i).length){switch(r.adContent=i,r.status=i.status,i.status){case"punt":e.countMetric(D,1),e.logCsaEvent(D),a.aaxInstrPixelUrl=i.instrPixelURL,G(e,a,t),r.aaxReturnedPunt=!0;break;case"error":e.countMetric(N,1),e.logCsaEvent(N),e.handleFallbackBehavior(),r.aaxReturnedError=!0;break;default:try{a.aaxImpPixelUrl=i.impPixelURL,a.aaxInstrPixelUrl=i.instrPixelURL,a.htmlContent=i.creative,a.measurementHtml=null==i?void 0:i.aaxMeasurementTrackers.html,a.adFeedbackInfo&&(a.adFeedbackInfo.adProgramId=i.programId),a.adCreativeMetaData&&(a.adCreativeMetaData.adProgramId=i.programId,a.adCreativeMetaData.adImpressionId=i.impPixelURL,(null==i?void 0:i.creativeIdStr)!=="null"&&(a.adCreativeMetaData.adCreativeId=i.creativeIdStr),a.adCreativeMetaData.adCreativeTemplateName=i.creativeTemplateName,(null==i?void 0:i.adIdStr)!=="null"&&(a.adCreativeMetaData.adId=i.adIdStr)),r.aaxReturnedContent=!0,e.sendAdBarTrace("aaxCall",r),await s(a.htmlContent,a.measurementHtml),e.countMetric(B,1),e.logCsaEvent(B)}catch(t){e.logError("Faiure",t),e.handleFallbackBehavior(),e.countMetric(U,1),e.logCsaEvent(U),r.error="renderError"}}window.adReporterConfig&&t.sendMessage("saveAdDetailsForAdReporter",a)}else e.countMetric(_,1),e.logCsaEvent(_),e.handleFallbackBehavior(),r.error="emptyAAXResponse";e.sendAdBarTrace("aaxCall",r)},Y=e=>e?e.toLowerCase().replace(/[^0-9a-z]/g,""):"unknown",Z=(e,t,i)=>{if(t&&t.adCreativeMetaData&&0!==Object.keys(t.adCreativeMetaData).length){let a=Y(t.adCreativeMetaData.adCreativeTemplateName);e.addCsmTag("adrender"),e.addCsmTag("adrender:safeframe"),e.addCsmTag("adrender","creativetemplatename:"+a),i.sendMessage("addCsaEntity",{adrender:"true",creativeTemplateName:a,isLightAds:"false"}),t.adCreativeMetaData.adCreativeId&&(e.addCsmTag("adrender","creativeid:"+t.adCreativeMetaData.adCreativeId),i.sendMessage("addCsaEntity",{creativeId:t.adCreativeMetaData.adCreativeId.toString()})),t.adCreativeMetaData.adProgramId&&(e.addCsmTag("adrender","programid:"+t.adCreativeMetaData.adProgramId),i.sendMessage("addCsaEntity",{adProgramId:t.adCreativeMetaData.adProgramId.toString()})),void 0!==t.isCardsFlow&&i.sendMessage("addCsaEntity",{isCardsFlow:t.isCardsFlow.toString()})}else e.addCsmTag("noadrender"),i.sendMessage("addCsaEntity",{adrender:"false"})},ee=async(e,t,i)=>{i.countMetric(O,1),i.logCsaEvent(s);let a={readyState:document.readyState};a.readyState=document.readyState,i.sendAdBarTrace("renderHtmlContentStart",a);let n=eo();if(t.renderCompleteTime&&"complete"!==document.readyState&&null!==document.currentScript){let t=document.currentScript;for(t.insertAdjacentHTML("afterend",e),t=t.nextElementSibling;null!==t;)"SCRIPT"===t.tagName?ed(t):ec(t),t=t.nextElementSibling}else el(e),er(),ec(document.documentElement);t.ensureGlobals(),await n,await ev(),t.renderCompleteTime=new Date,window.addEventListener("load",()=>{!t.isLdFired&&(t.isLdFired=!0,i.sendLatencyMetric(R))}),window.addEventListener("load",i.fireViewableLatencyMetrics),i.countMetric(V,1),i.logCsaEvent(r),a.readyState=document.readyState,i.sendAdBarTrace("renderHtmlContentEnd",a)},et="creativeReplayStatus",ei="iscomplete",ea="creativeReplayComplete",es=`document.dispatchEvent(new CustomEvent("${ea}"));`,er=()=>{document.body.innerHTML+=`<script id="${et}">${es}</script>`},en=e=>{var t;return null===(t=document.getElementById(et))||void 0===t?void 0:t.setAttribute(e,"true")},eo=()=>new Promise((e,t)=>{let i=document.getElementById(et);if((null==i?void 0:i.getAttribute(ei))==="true")e();else{document.addEventListener(ea,()=>{en(ei),e()},{once:!0});setTimeout(()=>{(null==i?void 0:i.getAttribute(ei))!=="true"&&t(Error("Creative script replay not detected within 5000 timeout"))},5e3)}}),ed=e=>{var t,i;let a=document.createRange();a.selectNode(e);let s=a.createContextualFragment(e.outerHTML),r=s.firstElementChild;if(r.getAttribute("src"))r.async=!1;else{let t=e.innerHTML;r.async=!1,r.setAttribute("src",`data:text/javascript;charset=UTF-8,${encodeURIComponent(t)}`)}null===(t=e.parentNode)||void 0===t||t.insertBefore(r,e.nextSibling),null===(i=e.parentNode)||void 0===i||i.removeChild(e)},el=e=>{if(void 0==document.documentElement){let e=document.createElement("html");document.appendChild(e)}document.documentElement.innerHTML=e},ec=e=>{let t=e.querySelectorAll("script");for(let e of t)ed(e)},eh=e=>e.naturalWidth>0||e.naturalHeight>0,em=e=>0===e.height||0===e.width,eu=e=>{!e.complete||eh(e)||em(e)};async function ev(){let e=document.querySelectorAll("img"),t=Array.from(e).filter(eu).map(e=>new Promise(t=>{e.addEventListener("load",()=>{t()},{once:!0})}));await Promise.all(t)}var eg=function(e,t,i){if(""===t)throw Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));var a=new URL(e),s=a.searchParams.get(t),r=Object.assign(JSON.parse(s||"{}"),i);return a.searchParams.set(t,JSON.stringify(r)),a.toString()};let ew=(e,t)=>{let i=document.createElement("img");return i.id=e,i.style.display="none",i.src=t,{img:i,completed:new Promise((e,t)=>(i.onload=()=>e(),i.onerror=(e,i,a,s,r)=>t(r),i))}},ep=(e,t,i)=>{let a=e+t;return i&&(a+="_"+i),a},ef=e=>!!document.getElementById(e),ey=async(e,{pixelUrl:t,id:i,baseCounterName:a,baseMetricName:s,counterExtension:r},n)=>{try{if(ef(i))return!1;{let{img:o,completed:d}=ew(i,t);return document.getElementsByTagName("body")[0].appendChild(o),e.logCsaEvent(ep(s,"fired",r)),e.countMetric(ep(a,"fired",r),1),e.sendAdBarTrace("pixels",{fired:{pixelUrl:t,additionalTrace:n}}),await d,e.countMetric(ep(a,"loaded",r),1),e.logCsaEvent(ep(s,"loaded",r)),e.sendAdBarTrace("pixels",{loaded:{pixelUrl:t,additionalTrace:n}}),!0}}catch(i){throw e.countMetric(ep(a,"error",r),1),e.logCsaEvent(ep(s,"error",r)),e.sendAdBarTrace("pixels",{error:{pixelUrl:t,additionalTrace:n}}),e.logError(`Error firing pixels: ${t}`,i),i}},eb=(e,t,i)=>e+t+JSON.stringify(i),eC="impressionFired",eM="btr:impression",eE={VIEWABLE:"viewable",NOT_VIEWABLE:"not_viewable"};class ex{constructor(){this._viewableStartTimeInMilliseconds=void 0,this._currentState=eE.NOT_VIEWABLE,this._isCurrentlyInNotViewableState=()=>this._currentState===eE.NOT_VIEWABLE,this.transitionToViewableState=e=>{this._isCurrentlyInNotViewableState()&&(this._viewableStartTimeInMilliseconds=e),this._currentState=eE.VIEWABLE},this.transitionToNotViewableState=()=>{this._currentState=eE.NOT_VIEWABLE},this.getViewableTimeInSeconds=e=>this._isCurrentlyInNotViewableState()||void 0===this._viewableStartTimeInMilliseconds?0:(e-this._viewableStartTimeInMilliseconds)/1e3}}var eI=function(e){for(var t=[],i=0,a=0,s=0;s<e.length;s++){var r=e[s];r instanceof HTMLImageElement&&(eT(r)?(t.push({src:r.src,isLoaded:!0}),a++):(t.push({src:r.src,isLoaded:!1}),i++))}return{isBTRCompliant:a>0&&0===i,imagesData:t}},eP=function(e){for(var t=[],i=0,a=0,s=0;s<e.length;s++){var r=e[s];r instanceof HTMLImageElement&&(eT(r)?!eS(r)&&(t.push({src:r.src,isLoaded:!0}),i++):(t.push({src:r.src,isLoaded:!1}),a++))}return{isBTRCompliant:i>0&&0===a,imagesData:t}},eT=function(e){return e.complete&&e.naturalHeight>0&&e.naturalWidth>0},eS=function(e){return 1===e.naturalHeight&&1===e.naturalWidth},eA=function(e){var t=e.getElementsByClassName("mrc-btr-creative"),i=t.length>0;if(i){var a=eI(t),s=a.isBTRCompliant,r=a.imagesData;return{isBTRTaggedCreative:i,isBTRCompliant:s,imagesData:r}}var n=eP(e.getElementsByTagName("img")),s=n.isBTRCompliant,r=n.imagesData;return{isBTRTaggedCreative:i,isBTRCompliant:s,imagesData:r}};let eL=e=>"Image"===e||"Image - mobile O&O"===e,eF=async e=>{let t=await fetch(e,{keepalive:!0});if(t.ok)return await t.json();throw Error(`Failed to fetch ad from ${e} due to ${t.status}`)};class eR{constructor(e,t,i){this.c=e,this.o=t,this.cms=i,this.viewedPixels={},this._viewableTimeCalculators={},this.hasLoaded=!1,this.fireImageLoaded=e=>{var t,i;if(!this.hasLoaded&&eL(e)){let e=null===(t=document.getElementsByClassName("ad-background-image"))||void 0===t?void 0:t[0];if(e&&"IMG"===e.tagName){if(e.complete)this.c.countMetric("imageLoaded",1,!0),this.c.countMetric("imageLoaded:adid:"+this.o.adCreativeMetaData.adId,1,!0),this.hasLoaded=!0;else{let t=null===(i=e.onload)||void 0===i?void 0:i.bind(window);e.onload=e=>{t&&t(e),this.c.countMetric("imageLoaded",1,!0),this.c.countMetric("imageLoaded:adid:"+this.o.adCreativeMetaData.adId,1,!0),this.hasLoaded=!0}}}}},this.fireImpressionPixel=async(e,t)=>{if(t)await ey(this.c,{id:"ape_ni_impression",pixelUrl:eb(this.o.aaxInstrPixelUrl,"nii/",{ni:!0}),baseCounterName:"adload:unservedimpression",baseMetricName:"unservedimpression"});else{let t=this.o.adCreativeMetaData.adProgramId?this.o.adCreativeMetaData.adProgramId:"unknown",i=this.o.adCreativeMetaData.adCreativeTemplateName,a=Y(i),s=this.o.adCreativeMetaData.adId,r=!1,n=eD(this.o.aaxImpPixelUrl,e);r="btr_client"===e;let o=await ey(this.c,{id:"ape_impression",pixelUrl:n,baseCounterName:"adload:impression",baseMetricName:"impression"});o&&(this.c.countMetric(eC,1,!0),this.c.countMetric(eC+":program:"+t,1,!0),this.c.countMetric(eC+":template:"+a,1,!0),r&&(this.c.countMetric(eM,1,!1),this.c.countMetric(eM,1,!0),this.c.countMetric(eM+":program:"+t,1,!0),this.c.countMetric(eM+":template:"+a,1,!0)),eL(i)&&this.c.countMetric(eC+":adid:"+s,1,!0))}},this.fireMeasurabilityPixel=e=>{if(v(this.o)||v(this.c)||!this.o.aaxInstrPixelUrl)return;let t="ape_measurability";!this.viewedPixels[t]&&(ey(this.c,{id:t,pixelUrl:eb(this.o.aaxInstrPixelUrl,"atf/",{atf:e.atf}),baseCounterName:"adload:measurability",baseMetricName:"measurability"}),this.viewedPixels[t]={})},this.fireViewablePixelsForVideo=(e,t,i,a,s)=>{if(v(this.o)||v(this.c)||!this.o.aaxInstrPixelUrl||!i)return;let r=(e,t,i)=>{let a=e>=i.t,s=t&&t>=i.t;return a&&s},d=i=>{let s;t.v=i,t.ptv=void 0!==this.o.aPageStart?(Date.now()-this.o.aPageStart)/1e3:0,t.ttv=void 0!==this.o.adStartTime?(Date.now()-this.o.adStartTime)/1e3:0,a&&(t.niv=!0);let r={viewableInfo:t,aaxInstrPixelUrl:this.o.aaxInstrPixelUrl,viewablePercentage:e};a?(s=eb(this.o.aaxInstrPixelUrl,"niv/",t),ey(this.c,{id:"ape_ni_viewability_"+i.def,pixelUrl:s,baseCounterName:W,baseMetricName:o,counterExtension:i.def},r)):(s=eb(this.o.aaxInstrPixelUrl,"v/",t),ey(this.c,{id:"ape_viewability_"+i.def,pixelUrl:s,baseCounterName:H,baseMetricName:n,counterExtension:i.def},r))},l=(e,t)=>{let i=e.def;t&&ek(t,e.p)?this._viewableTimeCalculators[i].transitionToViewableState(Date.now()):this._viewableTimeCalculators[i].transitionToNotViewableState();let a=this._viewableTimeCalculators[i].getViewableTimeInSeconds(Date.now()),n=!this.viewedPixels[i].viewed&&r(a,s,e);n&&(this.viewedPixels[i].viewed=!0,d(e))};for(let e=0;e<i.length;e++){let t=i[e].def;t&&(this.viewedPixels[t]=this.viewedPixels[t]||{},this.viewedPixels[t].viewed=void 0!==this.viewedPixels[t].viewed&&this.viewedPixels[t].viewed,void 0===this._viewableTimeCalculators[t]&&(this._viewableTimeCalculators[t]=new ex))}for(let t=0;t<i.length;t++)l(i[t],e)},this.fireViewablePixels=(e,t,i,a)=>{var s;let r=i=>{let s;t.v=i,t.ptv=void 0!==this.o.aPageStart?(Date.now()-this.o.aPageStart)/1e3:0,t.ttv=void 0!==this.o.adStartTime?(Date.now()-this.o.adStartTime)/1e3:0,a&&(t.niv=!0);let r={viewableInfo:t,aaxInstrPixelUrl:this.o.aaxInstrPixelUrl,viewablePercentage:e};a?(s=eb(this.o.aaxInstrPixelUrl,"niv/",t),ey(this.c,{id:"ape_ni_viewability_"+i.def,pixelUrl:s,baseCounterName:W,baseMetricName:o,counterExtension:i.def},r)):(s=eb(this.o.aaxInstrPixelUrl,"v/",t),ey(this.c,{id:"ape_viewability_"+i.def,pixelUrl:s,baseCounterName:H,baseMetricName:n,counterExtension:i.def},r))},d=t=>{let i=t.p,a=t.t,s=t.def;!this.viewedPixels[s].viewed&&e&&ek(e,i)?!this.viewedPixels[s].timeout&&(this.viewedPixels[s].timeout=setTimeout(()=>{this.viewedPixels[s].viewed=!0,r(t)},1e3*a)):this.viewedPixels[s].timeout&&(clearTimeout(this.viewedPixels[s].timeout),this.viewedPixels[s].timeout=null)};for(let e of i){let t=e.def;!(null===(s=this.viewedPixels)||void 0===s?void 0:s[t])&&(this.viewedPixels[t]={viewed:!1,timeout:null}),d(e)}}}}let ek=(e,t)=>100*e>=t&&0!==t||100*e>t&&0===t,eD=(e,t)=>eg(e,"pj",{measurementMethod:t}),eN=()=>{var e;let t=(e=document,eA(document.body));return t.isBTRCompliant?"btr_client":"cod_client"};class e_{constructor(e,t,i,a,s){this.cms=e,this.o=t,this.mL=i,this.renderFallbackExperience=a,this.doneFunc=s,this.expandAdSlot=e=>{this.cms.sendMessage("expandAdSlot",e)},this.expandAdSlotWithOverlap=e=>{this.cms.sendMessage("expandAdSlotWithOverlap",e)},this.resetSlotSize=()=>{this.cms.sendMessage("resetSlotSize")},this.fireImpression=async e=>{this.sendLatencyMetric(k),await this.cr.fireImpressionPixel(e.measurementMethod,e.isNoInventory),this.cms.sendMessage("clearCODFallback")},this.sendAdBarTrace=(e,t)=>{this.cms.sendMessage("sendAdBarTrace",{field:e,traceInfo:t})},this.changeSize=(e,t)=>{this.cms.sendMessage("changeSize",{width:e,height:t})},this.logCsaEvent=e=>{this.cms.sendMessage("logCsaEvent",{metricName:e})},this.addCsaEntity=e=>{this.cms.sendMessage("addEntity",e)},this.registerCustomMessageListener=(e,t)=>{this.mL[e]=t},this.sendLatencyMetric=e=>{this.cms.sendMessage("sendLatencyMetric",{latencyMetricType:e,timestamp:new Date})},this.countMetric=(e,t,i)=>{this.cms.sendMessage("countMetric",{metricMsg:e,value:t,isGlobal:!!i})},this.addCsmTag=(e,t,i)=>{this.cms.sendMessage("addCsmTag",{tag:e,msg:t,isGlobal:i})},this.fireViewableLatencyMetrics=()=>{this.cms.sendMessage("fireViewableLatencyMetrics",{adLoadedTimestamp:Date.now()})},this.feedbackLabelRendered=()=>{this.cms.sendMessage("feedbackLabelRendered")},this.feedbackOpenModal=()=>{this.cms.sendMessage("feedbackOpenModal")},this.customMessage=(e,t)=>{this.cms.sendMessage("customMessage",{key:e,body:t})},this.updateViewability=e=>{var t,i,a,s,r;let n=x();if(P(e),!this.o.aaxInstrPixelUrl||!n.payload||!n.viewabilityStandards)return;!this.o.isNoInventory&&void 0!==e.atf&&this.cr.fireMeasurabilityPixel(e);let o=(null===(i=null===(t=null==window?void 0:window.$sf)||void 0===t?void 0:t.ext)||void 0===i?void 0:i.geom)&&(null===(a=null==window?void 0:window.$sf)||void 0===a?void 0:a.ext.geom()),l=(null===(s=null==o?void 0:o.self)||void 0===s?void 0:s.iv)?null===(r=null==o?void 0:o.self)||void 0===r?void 0:r.iv:null;if(d(this.o.mediaType)){let e=I();this.cr.fireViewablePixelsForVideo(l,n.payload(),n.viewabilityStandards(),!!this.o.isNoInventory,e.playingTime?e.playingTime():null)}else this.cr.fireViewablePixels(l,n.payload(),n.viewabilityStandards(),!!this.o.isNoInventory)},this.updatePlayingTimeForVideo=e=>{var t,i,a;let s=x();T(e);let r=(null===(i=null===(t=null==window?void 0:window.$sf)||void 0===t?void 0:t.ext)||void 0===i?void 0:i.geom)&&window.$sf.ext.geom(),n=null===(a=null==r?void 0:r.self)||void 0===a?void 0:a.iv;if(n&&s.payload&&s.viewabilityStandards){let e=I();this.cr.fireViewablePixelsForVideo(n,s.payload(),s.viewabilityStandards(),!!this.o.isNoInventory,e.playingTime?e.playingTime():null)}},this.requestVideoAutoplay=()=>{this.cms.sendMessage("requestVideoAutoplay")},this.releaseVideoAutoplay=()=>{this.cms.sendMessage("releaseVideoAutoplay")},this.haveVideoAutoplayPermission=()=>{this.cms.sendMessage("haveVideoAutoplayPermission")},this.isOnAmazon=()=>eB(this.o.hostDomain),this.sendRelocatedHtmlContentEncodedToAd=e=>{let t=new window.CustomEvent("loadAdWithRelocatedHtmlContent",{detail:{htmlContentEncoded:e}});document.dispatchEvent(t)},this.collapseSlotInternal=()=>{this.logAPIInvocation("collapseSlot"),this.cms.sendMessage("collapseSlot")},this.logError=(e,t,i)=>{this.cms.sendMessage("logError",{message:e,error:t,level:i})},this.executePostCreativeRenderingSteps=()=>{this.doneFunc()},this.collapseSlot=()=>{this.handleFallbackBehavior()},this.handleFallbackBehavior=()=>{this.logAPIInvocation("handleFallbackBehavior"),this.renderFallbackExperience()},this.handleFallbackExperience=()=>{this.cms.sendMessage("handleFallbackExperience")},this.resizeCreativeWrapper=e=>{let t=window.document.getElementById(this.o.slot+"_creativeWrapper");null!==t&&(t.style.height=e.height,t.style.width=e.width)},this.triggerEventInIframe=e=>{window.dispatchEvent(new Event("outerpage"+e.eventType))},this.logAPIInvocation=(e,...t)=>{this.cms.sendMessage("logAPIInvocation",{apiName:e,apiParams:t}),this.cms.sendMessage("logCsaEvent",{metricName:"messenger_"+e})},this.cr=new eR(this,t,e)}}let eB=e=>/\.amazon\.(com?\.)?[a-z]{2,4}:?/i.test(e);class eU extends e_{constructor(e,t,i,a,s){super(e,t,i,s,a),this.isSupported=()=>!0,this.getARID=()=>this.o.arid,this.getDebugInfo=e=>{this.logAPIInvocation("getDebugInfo");let t=eO(this.o.slotName),i={slot:this.o.slot,slotName:this.o.slotName,shazamId:null==t?void 0:t.shazamId,creativeId:null==t?void 0:t.creativeId,adId:null==t?void 0:t.adId,src:this.o.src,iframeHtml:window.document.body.innerHTML||""};this.customMessage(e.key,i)},this.sendAdInfo=e=>{e&&this.o.adCreativeMetaData&&(this.o.adCreativeMetaData=e)},this.getQueryParam=e=>{this.logAPIInvocation("getQueryParam"),this.countMetric("getqueryparam:"+e,1);let t="";return void 0!==this.o.queryParams&&"string"==typeof e&&(0!==e.indexOf("sf-")&&(t="sf-"+e),t=this.o.queryParams[t]||""),t},this.getPlacementInfo=()=>{this.logAPIInvocation("getPlacementInfo");let e={slot:this.o.slot,slotName:this.o.slotName,pageType:this.o.pageType};return e}}}let eO=e=>{var t;return(null==window?void 0:window.aanResponse)||(window.document.aanResponse?null===(t=window.document)||void 0===t?void 0:t.aanResponse[e+"adData"]:void 0)},eV=()=>{window.dcmads=window.dcmads||{},window.dcmads.eids="4|40004007"},eH=(e,t,i,a)=>{try{i.countMetric(O,1),i.logCsaEvent(s),e.setupOMVideoPlayer(t,a),i.countMetric(V,1),i.logCsaEvent(r)}catch(e){i.handleFallbackBehavior()}};class eW{constructor(e,t){this.o=e,this.messagePort=t,this.sendMessage=(e,t)=>{let i={command:e,arid:this===null||void 0===this?void 0:this.o.arid,data:t||{}};try{this.messagePort.postMessage(i)}catch(e){Q("Post Message error",e)}}}}class ez{constructor(e,t,i){this.c=e,this.o=t,this.mL=i,this.receiveMessage=e=>{try{let t=e.data,i=t.command?t.command.split("."):[],a=this.c[i[0]];for(let e=1;e<i.length&&a;e++)a=a[i[e]];if("customMessage"===t.command){let e=t.data.key,i=t.data.data;if("function"==typeof this.mL[e])try{this.mL[e](i)}catch(e){this.c.logError("Custom Message Listener Error",e)}}else a&&a(t.data)}catch(t){this.c.logError("Error with "+e.data.command,t);return}}}}var e$=function(e,t){void 0===t&&(t=1),ej()&&eq(eJ(e),t)},ej=function(){var e;return"function"==typeof(null===(e=null==window?void 0:window.ue)||void 0===e?void 0:e.count)},eq=function(e,t){var i;return null===(i=null==window?void 0:window.ue)||void 0===i?void 0:i.count(e,t)},eG="adplacements",eJ=function(e){return e.startsWith(eG)?e:"".concat(eG,":").concat(e)},eK={ERROR:"ERROR"},eQ=function(e,t){var i=t||Error(e);console.error(e,t),e$("safeFrameError"),window.ueLogError&&window.ueLogError(i,{logLevel:eK.ERROR,attribution:"APE-safeframe",message:e+" "})};let eX=(e,t)=>{!t.disableResizeFunc&&e.sendMessage("resizeSafeFrameAd"),t.resizePlacementStyle&&e.sendMessage("setResizePlacementStyle")};class eY{handleServerSideFetchAd(){var e,t;let i;let a={serverSide:null===(e=this.o)||void 0===e?void 0:e.serverSideFetchAd};if(this.o.htmlContentEncoded){let e=this.o.htmlContentEncodedLength?this.o.htmlContentEncoded:m(this.o.htmlContentEncoded);if(this.o.htmlContentEncodedLength&&e.length!==this.o.htmlContentEncodedLength)throw Error(`Mismatched expected htmlContentEncoded size. Expected ${this.o.htmlContentEncodedLength} but got ${e.length}`);let t=m(this.o.measurementHtmlEncoded?this.o.measurementHtmlEncoded:"");a.htmlContent=e,i=async()=>{await this.loadAd(e,t)}}else if(null===(t=this.o.expParams)||void 0===t?void 0:t.ilmRelocatedHtmlIsActive)i=async()=>{await $(this.loadAd,this.o.measurementHtmlEncoded)};else throw Error("No html content found on a server side fetch");return{writeAdHandler:i,adRenderFlowTrace:a}}constructor(e,t,i,a,s){this.o=e,this.mp=t,this.mL=i,this.cms=a,this.c=s,this.isLdFired=!1,this.renderCompleteTime=null,this.hasCODFallbackRegistered=!1,this.isDone=!1,this.initSFClient=async()=>{this.ensureGlobals(),j(),q(),document.write=this.renderHtmlCallthrough,document.open=(...e)=>{this.nativeOpen(...e),this.ensureGlobals()},this.mp.onmessage=this.cmr.receiveMessage,this.c.sendLatencyMetric(F),this.cms.sendMessage("safeFrameReady"),this.c.countMetric("adload:iframeinitialized",1),this.c.logCsaEvent("adload_iframeinitialized"),window.writeAdHandler=null,eX(this.cms,this.o);let e=this.setupHandlers();e&&(window.writeAdHandler=e,await window.writeAdHandler()),eZ(this.mL,this.cms)},this.setupHandlers=()=>{if("true"!==this.o.abpAcceptable&&this.o.enableFallbackForAbpStatuses&&this.o.abpStatus&&(this===null||void 0===this?void 0:this.o.enableFallbackForAbpStatuses.indexOf(h[this.o.abpStatus]))>-1)return this.forceRenderFallbackExperience(),null;let{writeAdHandler:e,adRenderFlowTrace:t}="true"===this.o.serverSideFetchAd?this.handleServerSideFetchAd():this.handleClientSideFetchAd();return this.c.sendAdBarTrace("adRenderFlow",t),e},this.handleClientSideFetchAd=()=>{var e;let t={serverSide:null===(e=this.o)||void 0===e?void 0:e.serverSideFetchAd},i=J(this.o.hostDomain)?K(this.o.src):this.o.src;t.adSource=i,t.isXsp=!i.includes("x/getad");let a=async()=>{try{this.c.countMetric("adfetch:request",1),this.c.logCsaEvent("adfetch_request");let e=await eF(i);await X(this.c,this.cms,e,this.o,this.loadAd)}catch(e){this.c.countMetric("adfetch:httperror",1),this.c.logCsaEvent("adfetch_httperror"),this.c.logError("Failed to Fetch Ad From AAX."),this.c.sendAdBarTrace("aaxCall",{error:"httpError"}),this.c.handleFallbackBehavior()}};return{writeAdHandler:a,adRenderFlowTrace:t}},this.ensureGlobals=()=>{window.onerror=this.handleErrors,window.$sf=E(),window.$sfViewableInfo=x(),window.aaxInstrPixelUrl=this.o.aaxInstrPixelUrl},this.renderHtmlCallthrough=async e=>{!this.hasCODFallbackRegistered&&!this.o.firePixelsAfter&&(this.cms.sendMessage("registerCODFallback",eD(this.o.aaxImpPixelUrl,z)),this.hasCODFallbackRegistered=!0),await ee(e,this,this.c),await this.done()},this.renderFallbackExperience=()=>{!this.renderCompleteTime&&this.forceRenderFallbackExperience()},this.addOnLoadListeners=()=>{window.addEventListener("load",()=>{!this.isLdFired&&(this.isLdFired=!0,this.c.sendLatencyMetric(R))}),window.addEventListener("load",this.c.fireViewableLatencyMetrics)},this.handleErrors=(e,t,i,a,s)=>{let r=s||Error(e.toString());return this.c.logError(r.message,r),this.renderFallbackExperience(),!0},this.forceRenderFallbackExperience=()=>{let e=this.o.fallbackStaticAdImgUrl&&this.o.fallbackStaticAdClickUrl;e?(this.renderFallbackStaticAd(this.o.fallbackStaticAdImgUrl,this===null||void 0===this?void 0:this.o.fallbackStaticAdClickUrl,this.o.fallbackStaticAdExtraStyle),this.renderCompleteTime=new Date):this.c.collapseSlotInternal(),this.c.handleFallbackExperience()},this.done=async()=>{let e={};if(this.isDone)e.firstInvocation=!1;else{e.firstInvocation=!0,this.isDone=!0;let t=await eN();e2(),e3(),this.cms.sendMessage("startPixelTracking",{isNoInventory:!1,measurementMethod:t}),this.o.adCreativeMetaData&&this.c.cr.fireImageLoaded(this.o.adCreativeMetaData.adCreativeTemplateName),this.c.countMetric("adload:creativewritten",1),this.c.logCsaEvent("adload_creativewritten")}document.addEventListener("touchstart",{handleEvent:()=>{}},!1),this.c.sendAdBarTrace("doneFunction",e)},this.cmr=new ez(s,e,this.mL),this.nativeWrite=document.write.bind(document),this.nativeOpen=document.open.bind(document),window.onerror=this.handleErrors}}let eZ=(e,t)=>{e.initAdReporter=e=>{try{window.adReporterConfig=e;let i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src=e&&e.adReporterClientUrl?e.adReporterClientUrl:"",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(i),t.sendMessage("saveAdDetailsForAdReporter")}catch(e){eQ("Error appending adReporterClient script",e)}}},e0=async e=>new Promise((t,i)=>{e.onmessage=e=>{let a=e.data;"adDetails"!==a.command?i(`Incorrect message received ${a.command}`):t(a.data)}}),e1=async(e,t=3e4)=>{let i=new Date().getTime();for(;;)try{return await e0(e)}catch(a){let e=new Date().getTime()-i;if(e>t){let e=`Failed to receive adDetails from host within ${t} ms`,i=Error(e);throw eQ(e,i),i}}},e3=()=>{en("creativeLoad"),window.dispatchEvent(new Event("load"))},e2=()=>{en("creativedomcontentloaded"),document.dispatchEvent(new Event("DOMContentLoaded"))};class e4 extends eY{constructor(e,t){let i=new eW(e,t),s={};super(e,t,s,i,new eU(i,e,s,()=>this.done(),()=>this.forceRenderFallbackExperience())),this.renderFallbackStaticAd=(e,t,i)=>{document.documentElement.innerHTML='<a target="_top" href="'+t+'"><img src="'+e+'" '+(i||"")+"></a>",this.ensureGlobals(),this.mp.onmessage=this.cmr.receiveMessage,this.isDone=!0},this.loadAd=async(e,t)=>{if(this.o.isNoInventory=!1,Z(this.c,this.o,this.cms),!this.renderCompleteTime){let i=e;this.o.clickTracking&&(i=a(this.o.clickTracking,i)),t&&t.length&&(this.c.countMetric("adload:measurementhtml",1),this.c.logCsaEvent("measurementhtml")),c(this.o.mediaType,this.o.adCreativeMetaData.adProgramId)?eH(window,this.o,this.c,i):("string"==typeof t&&(i=i.concat(t)),await this.renderHtmlCallthrough(i))}}}}let e7=async e=>{try{eV();let t=await e1(e),i=new e4(t,e);window.SFClient=i.c,await i.initSFClient()}catch(e){Q("Could not init ",e)}};!window.SFClient&&(e=>{let t=i=>{if(i.ports){let a=i.ports[0]?i.ports[0]:i.data;e(a),window.removeEventListener("message",t)}else console.debug("Not a MessagePort message; will continue to wait")};window.addEventListener("message",t)})(e7)})();
//# sourceMappingURL=sf-1.50.b12230b4.js.map
